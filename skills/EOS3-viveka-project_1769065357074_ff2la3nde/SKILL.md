---
name: invoice-organizer
description: 专业的发票信息提取与费用报销台账生成工具。自动识别发票图片中的关键信息（购买方名称、开票日期、金额、税额、发票号码、发票类型），智能分类排序，按月统计报销总额，生成包含明细和汇总两个工作表的Excel费用报销台账。支持增值税专用发票、普通发票、电子发票等多种类型。使用触发词「整理发票」或「生成费用台账」启动完整处理流程。 当用户需要批量处理发票图片、提取发票信息、生成报销台账或统计报销金额时激活
license: MIT
compatibility: 需要 Python 3.8+ 环境，支持 OpenCV、Tesseract OCR 或云端 OCR API（如百度 OCR、腾讯云 OCR、阿里云 OCR）。适用于处理 JPEG、PNG、PDF 格式的发票图片。
metadata:
  homepage: 
  repository: 
  tags:
    - 发票识别
    - OCR
    - 财务自动化
    - Excel生成
    - 数据提取
  language: Python
allowed-tools:
  - Read
  - Write
  - Bash
  - Glob
  - Grep
  - Edit
  - WebFetch
  - Task
---

# 发票整理助手

专业的发票信息提取与费用报销台账生成工具。自动识别发票图片中的关键信息（购买方名称、开票日期、金额、税额、发票号码、发票类型），智能分类排序，按月统计报销总额，生成包含明细和汇总两个工作表的Excel费用报销台账。支持增值税专用发票、普通发票、电子发票等多种类型。使用触发词「整理发票」或「生成费用台账」启动完整处理流程。

## 使用场景

当用户需要批量处理发票图片、提取发票信息、生成报销台账或统计报销金额时激活

**触发关键词:** 整理发票, 生成费用台账, 发票信息提取, 报销台账, 发票识别

**激活模式:**
- `.*发票.*整理.*`
- `.*生成.*台账.*`
- `.*提取.*发票.*信息.*`
- `.*报销.*统计.*`

## 使用说明

=== 发票整理技能参考文档 ===

[核心功能]
本技能实现自动化发票信息提取和台账生成，主要包括：
1. 发票图片识别：支持增值税专用发票、普通发票、电子发票等多种格式
2. 信息提取：自动提取购买方名称、开票日期、金额、税额、发票号码、发票类型
3. 智能分类：按发票类型和开票日期进行分类排序
4. 统计分析：按月份统计报销总额，生成汇总数据
5. 台账生成：输出包含明细表和汇总表的Excel文件

[技术实现方案]
- OCR识别：推荐使用云端OCR服务（百度OCR、腾讯云OCR、阿里云OCR）获得更高准确率
- 数据处理：使用 pandas 进行数据清洗、排序和统计
- Excel生成：使用 openpyxl 或 xlsxwriter 创建多工作表Excel文件
- 图像预处理：使用 OpenCV 进行图像增强以提高识别率

[工作流程]
1. 收集用户上传的发票图片文件
2. 对每张发票进行OCR识别
3. 解析识别结果，提取关键字段
4. 数据验证和清洗（日期格式、金额格式等）
5. 按开票日期排序，按发票类型分类
6. 计算月度汇总数据
7. 生成Excel文件：工作表1为明细表，工作表2为汇总表
8. 返回处理结果和统计报告

[数据结构]
明细表字段：序号、购买方名称、开票日期、发票类型、发票号码、金额、税额、价税合计
汇总表字段：月份、发票数量、总金额、总税额、价税合计

[最佳实践]
- 建议发票图片分辨率不低于1200x1600像素
- 确保发票图片清晰，避免模糊、反光、折叠
- 对于识别失败的发票，提供人工复核机制
- 定期备份生成的台账文件
- 使用批量处理时，建议每批不超过50张发票以确保稳定性

## 功能概述

发票整理助手是一个智能化的AI助手技能。专业的发票信息提取与费用报销台账生成工具。自动识别发票图片中的关键信息（购买方名称、开票日期、金额、税额、发票号码、发票类型），智能分类排序，按月统计报销总额，生成包含明细和汇总两个工作表的Excel费用报销台账。支持增值税专用发票、普通发票、电子发票等多种类型。使用触发词「整理发票」或「生成费用台账」启动完整处理流程。

该技能通过自然语言理解技术，能够准确识别用户意图并提供专业的处理结果。无论是简单的查询还是复杂的分析任务，都能提供高质量的输出。


## 详细使用指南

### 基本用法

1. **激活技能**: 通过相关关键词或直接描述您的需求来激活此技能
2. **提供输入**: 清晰地描述您的任务或问题，提供必要的上下文信息
3. **获取结果**: AI 将处理您的请求并返回详细的结果

### 进阶用法

- 对于复杂任务，可以分步骤描述需求
- 可以指定输出格式和详细程度
- 支持追问和结果优化


## 功能特点

- **智能识别**: 自动识别用户意图，匹配最合适的处理方式
- **灵活适应**: 支持多种输入格式和表述方式
- **专业输出**: 提供结构化、专业化的处理结果
- **持续学习**: 基于用户反馈不断优化表现


## 常见应用场景

### 场景一：快速查询
当您需要快速获取信息或解答疑问时，可以直接向技能提问。

### 场景二：内容处理
当您需要处理、转换或分析内容时，提供原始内容和期望的处理方式。

### 场景三：创意生成
当您需要创意支持或内容创作时，描述您的需求和偏好。


## 注意事项

- 确保输入内容符合技能的处理范围
- 复杂任务可能需要更长的处理时间
- 如结果不满意，可以提供更多细节重新尝试
- 对于敏感信息，请注意隐私保护


## 技术说明

此技能基于先进的自然语言处理技术，结合领域知识库，能够提供专业、准确的处理结果。系统会根据输入内容自动选择最优的处理策略，确保输出质量。

## 示例

### 基础发票整理

**用户输入:**
```
我有10张发票图片在 /invoices 目录下，请帮我整理并生成费用台账
```

### 按月统计报销

**用户输入:**
```
整理这些发票并按月生成报销统计
```

### 发票类型分类

**用户输入:**
```
帮我整理这些发票，需要按专票、普票、电票分类
```

## 资源文件

### 参考文档

- `resources/ocr-guide.md`: 发票OCR识别的技术指南和优化建议
- `resources/excel-generation.md`: 使用Python生成多工作表Excel文件的技术文档
- `resources/invoice-fields.md`: 中国发票标准字段定义和提取规则

### 脚本

- `scripts/invoice_ocr.py`: 发票OCR识别脚本
- `scripts/excel_generator.py`: Excel台账生成脚本

### 模板

- `templates/invoice_template.json`: 标准发票数据结构模板
- `templates/report_config.json`: 费用报销台账生成配置

## 常见问题

**问: OCR识别不准确怎么办？**

答: 1. 确保发票图片清晰，分辨率建议300dpi以上
2. 避免图片模糊、反光、折叠
3. 对图片进行预处理：去噪、二值化、倾斜校正
4. 尝试更换OCR服务提供商（百度、腾讯云、阿里云）
5. 对于识别失败的字段，可在生成的Excel中手动修正

**问: 如何处理PDF格式的发票？**

答: 1. 使用 pdf2image 库将PDF转换为图片
2. 对每页图片分别进行OCR识别
3. 或使用支持PDF直接识别的OCR API
4. 注意PDF可能包含多张发票，需要逐页处理

**问: 生成的Excel文件格式不正确？**

答: 1. 检查 openpyxl 或 xlsxwriter 库是否正确安装
2. 确认数据格式：日期为字符串格式YYYY-MM-DD，金额为浮点数
3. 检查工作表名称是否包含非法字符
4. 验证Excel文件路径是否有写入权限

**问: 如何按发票类型分类统计？**

答: 1. 在OCR识别时准确提取发票类型字段
2. 统一发票类型命名：专票、普票、电票
3. 在汇总表中添加按类型分组的统计
4. 可以为不同类型的发票设置不同颜色标记

**问: 批量处理大量发票时程序卡顿？**

答: 1. 分批处理，每批建议不超过50张
2. 使用多线程或异步处理提高效率
3. 优化图片大小，降低OCR请求负担
4. 添加进度显示，便于了解处理状态
5. 考虑使用队列机制处理大批量任务

## 调试指南

[调试指南]

1. OCR识别调试
   - 打印OCR API返回的原始JSON结果
   - 检查图片base64编码是否正确
   - 验证API密钥和权限配置
   - 测试单张发票识别确认API可用性

2. 数据提取调试
   - 输出提取的字段值，检查是否为空
   - 验证日期格式转换是否正确
   - 检查金额和税额的数据类型
   - 确认发票类型映射关系

3. Excel生成调试
   - 检查pandas DataFrame结构
   - 验证工作表创建和命名
   - 测试单独的明细表和汇总表生成
   - 确认文件保存路径和权限

4. 性能调试
   - 记录每张发票的处理时间
   - 监控内存使用情况
   - 检查是否有重复的API调用
   - 优化图片读取和处理流程

5. 常见错误处理
   - 捕获OCR API异常（网络超时、配额超限）
   - 处理图片格式不支持的情况
   - 处理日期解析失败
   - 处理Excel写入权限错误

---

## 元数据

| 字段 | 值 |
|------|----|
| 版本 | 1.0.0 |
| 作者 | Viveka |
| 分类 | 办公自动化, 财务工具, 数据处理 |
| 技能类型 | automation, data-processing |

## 更新日志

- **v1.0.0** (2026-01-22): added - 初始版本发布，支持发票OCR识别、信息提取、分类排序、月度统计和Excel台账生成

