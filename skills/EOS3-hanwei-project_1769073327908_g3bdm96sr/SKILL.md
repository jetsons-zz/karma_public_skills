---
name: image-prompt-extractor
description: "专业的图片提示词反向生成工具，能够将用户上传的图片或已生成的图片转换为详细的JSON格式描述信息。系统会自动分析图片的尺寸、构图、色彩、风格、主体对象等关键要素，并将英文描述翻译为中文，同时保留英文键名和完整数据结构。生成的JSON包含图片的详细元数据、视觉特征、艺术风格、技术参数等信息，方便用户后续对图片细节进行精确修改和调整。当用户说'反向解析图片'、'提取图片提示词'、'图片转JSON'、'分析图片描述'时会触发此技能。适用于AI绘画工作流优化、提示词学习、图片再创作等场景。 当用户需要从图片反向生成提示词描述、将图片转换为JSON格式的详细信息、分析图片的视觉特征和艺术风格、提取图片元数据用于后续修改时激活"
license: MIT
compatibility: 支持常见图片格式(PNG/JPG/WEBP/GIF)，需要Python 3.9+环境和Pillow库支持，使用Claude视觉模型进行图片分析，建议图片大小不超过10MB以获得最佳性能
metadata:
  homepage: 
  repository: 
  tags:
    - 图片分析
    - 提示词工程
    - AI绘画
    - 视觉识别
    - 元数据提取
  language: python
allowed-tools:
  - Read
  - WebFetch
  - Task
  - Bash
---

# 图片提示词反向解析器

专业的图片提示词反向生成工具，能够将用户上传的图片或已生成的图片转换为详细的JSON格式描述信息。系统会自动分析图片的尺寸、构图、色彩、风格、主体对象等关键要素，并将英文描述翻译为中文，同时保留英文键名和完整数据结构。生成的JSON包含图片的详细元数据、视觉特征、艺术风格、技术参数等信息，方便用户后续对图片细节进行精确修改和调整。当用户说'反向解析图片'、'提取图片提示词'、'图片转JSON'、'分析图片描述'时会触发此技能。适用于AI绘画工作流优化、提示词学习、图片再创作等场景。

## 使用场景

当用户需要从图片反向生成提示词描述、将图片转换为JSON格式的详细信息、分析图片的视觉特征和艺术风格、提取图片元数据用于后续修改时激活

**触发关键词:** 反向解析图片, 提取图片提示词, 图片转JSON, 分析图片描述, 图片反推提示词, 图生提示词, 图片元数据提取, 提示词逆向工程

**激活模式:**
- `.*图片.*(提示词|prompt|描述|JSON|元数据).*`
- `.*反向.*(解析|生成|提取).*图.*`
- `.*(分析|识别|解读).*图片.*(细节|信息|特征).*`

## 使用说明

# 图片提示词反向解析器 - 技术参考

## 功能概述

本技能通过AI视觉模型对图片进行深度分析，提取并生成包含以下维度的JSON格式描述信息：

- 基础属性：尺寸、分辨率、格式、文件大小
- 视觉特征：主体对象、构图方式、色彩方案、光影效果
- 艺术风格：绘画风格、艺术流派、技法特点
- 技术参数：镜头参数、渲染质量、后期效果
- 情感氛围：情绪基调、氛围营造、视觉张力

## 输出格式规范

生成的JSON严格保留英文键名，值部分的描述性文字翻译为中文，结构示例：

{
  "dimensions": {"width": 1024, "height": 768, "aspectRatio": "4:3"},
  "subject": "一位穿着红色连衣裙的年轻女性",
  "composition": "三分法构图，主体位于画面右侧",
  "colorPalette": ["深红色", "米白色", "淡蓝色"],
  "style": "印象派油画风格",
  "lighting": "柔和的侧光，营造戏剧性氛围",
  "mood": "宁静、优雅、怀旧"
}

## 技术实现原理

1. 图片预处理：读取图片文件，提取基础元数据
2. 视觉分析：调用Claude视觉模型API进行深度分析
3. 结构化输出：将分析结果组织为规范的JSON格式
4. 双语处理：保留英文键名，翻译描述性内容为中文

## 最佳实践

- 上传清晰、完整的图片以获得更准确的分析结果
- 对于复杂场景，可以要求生成分层次的描述信息
- 生成的JSON可直接用于AI绘画工具的提示词输入
- 建议保存分析结果作为提示词库的参考资料

## 注意事项

- 图片文件大小建议在10MB以内
- 过于抽象或模糊的图片可能影响分析精度
- 生成的提示词仅供参考，需结合实际创作需求调整
- 不支持视频文件的逐帧分析

## 示例

### 分析AI生成的人物肖像

**场景:** 用户学习优秀AI绘画作品的提示词构成，希望复现类似风格

**用户输入:**
```
帮我分析这张图片的提示词，我想知道它是怎么生成的
```

**预期输出:**
```
系统会读取图片并返回详细的JSON分析结果，包括：人物特征（性别、年龄、服饰、姿态）、构图方式（特写/半身/全身）、光影效果（柔光/硬光/环境光）、色彩基调（暖色/冷色/对比色）、艺术风格（写实/插画/CG渲染）、情绪氛围（严肃/活泼/神秘）等维度。所有描述性字段使用中文，键名保持英文，便于直接用于后续的提示词工程。
```

### 提取风景照片的视觉特征

**场景:** 用户需要将真实照片转换为特定艺术风格的插画

**用户输入:**
```
把这张风景照片转成JSON格式，我要改成插画风格
```

**预期输出:**
```
系统分析照片后生成包含以下信息的JSON：场景类型（山景/海景/城市/森林）、时间氛围（日出/正午/黄昏/夜晚）、天气状况（晴朗/多云/雨雾）、色彩分布（天空色、地面色、主色调）、构图元素（前景/中景/远景的内容）、视角参数（俯瞰/平视/仰视）、景深效果等。用户可基于此JSON调整style字段为'水彩插画风格'或'扁平化插画'等，用于重新生成。
```

### 批量分析图片库建立提示词数据库

**场景:** 专业创作者需要管理大量参考素材，建立可检索的提示词数据库

**用户输入:**
```
我有100张参考图，能批量反向生成提示词JSON吗
```

**预期输出:**
```
系统提供批处理脚本，用户将图片放入指定文件夹后运行脚本，自动遍历所有图片文件，逐一调用视觉分析API，生成对应的JSON文件并保存到输出目录。每个JSON文件以原图片名命名，包含完整的分析结果。处理完成后生成汇总报告，统计各类风格、色彩方案、构图类型的分布情况，帮助用户建立系统化的提示词知识库。
```

### 对比分析多张图片的风格差异

**场景:** 用户需要理解不同风格之间的细微差别，用于精确控制生成结果

**用户输入:**
```
分析这三张图片的风格区别，生成对比JSON
```

**预期输出:**
```
系统分别分析三张图片后，生成一个对比型JSON结构，包含：共同特征（相同的主体类型、色系范围）、差异维度（不同的艺术风格、构图方式、光影处理、细节密度）、风格演变建议（如何从风格A过渡到风格B的提示词调整方向）。输出格式为数组，每个元素是一张图片的完整分析，并附加一个comparison字段总结关键差异点。
```

### 提取图片的技术参数用于复现

**场景:** 用户希望复现高质量图片的渲染效果和技术水准

**用户输入:**
```
这张图的画质很好，帮我提取技术参数
```

**预期输出:**
```
系统重点分析技术维度，生成包含：分辨率规格、渲染质量评估（高清/超清/4K）、细节丰富度（精细/中等/简化）、后期效果（锐化/模糊/颗粒/色调映射）、推荐的质量提示词（如'highly detailed, 8k resolution, professional photography'的中文等价描述）等信息的JSON。用户可直接将这些技术参数添加到新的提示词中，以复现类似的画质水准。
```

## 资源文件

### 参考文档

- `resources/json-schema.md`: 详细定义图片分析结果的JSON数据结构和字段说明
- `resources/prompt-engineering.md`: 如何利用反向解析结果优化AI绘画提示词

### 脚本

- `scripts/analyze_image.py`: 调用AI视觉模型分析图片并生成JSON格式的详细描述信息
  - 用法: 使用方式：python scripts/analyze_image.py <图片路径> [输出JSON路径]。示例：python scripts/analyze_image.py photo.jpg output.json
- `scripts/batch_process.py`: 批量分析文件夹中的所有图片并生成对应的JSON文件
  - 用法: 使用方式：python scripts/batch_process.py <输入文件夹> <输出文件夹>。示例：python scripts/batch_process.py ./images ./outputs

### 模板

- `templates/analysis_output.md`: 将JSON分析结果格式化为易读的Markdown报告

## 常见问题

**问: 为什么分析结果的JSON格式不正确？**

答: 这可能是由于AI模型返回了额外的文字说明。请确保：1) 使用最新版本的脚本，它会自动清理多余内容；2) 检查API密钥是否正确配置；3) 如果问题持续，可以尝试重新运行分析。生成的JSON会自动验证格式并补全缺失字段。

**问: 分析出来的中文描述不够准确怎么办？**

答: 提高分析准确度的方法：1) 确保上传的图片清晰完整，分辨率足够；2) 如果是特定领域的专业图片（如医学影像、工程图纸），可在config.json中添加领域提示；3) 对于复杂场景，可以手动编辑JSON结果，补充或修正描述；4) 积累分析结果后建立个人校正词典。

**问: 批量处理时遇到API限流怎么办？**

答: API限流的解决方案：1) 在batch_process.py中已内置了1秒延迟，如仍超限可增加time.sleep的时间；2) 使用付费API账户以获得更高的速率限制；3) 分批次处理，每批20-30张图片；4) 检查_summary.json中的失败记录，单独重新处理失败的图片。

**问: 生成的JSON如何直接用于AI绘画工具？**

答: JSON转换为提示词的步骤：1) 提取visual和artistic字段的核心描述；2) 按'主体+风格+构图+色彩+光影+氛围'的顺序组织；3) 添加quality和technical字段中的技术参数作为后缀；4) 使用提供的templates模板自动格式化；5) 不同平台需要微调格式，可参考resources/prompt-engineering.md中的跨平台适配指南。

**问: 如何处理包含文字的图片？**

答: 对于包含文字的图片：1) 系统会在visual.textContent字段中识别并记录图片中的文字内容（如有）；2) 文字的字体风格会体现在artistic.typography字段中；3) 如果文字是主体元素，会在visual.subject中重点描述；4) 注意：纯文字识别（OCR）不是此工具的主要功能，重点是视觉风格分析。

## 调试指南

# 调试指南

## 常见问题排查流程

### 1. 分析失败或无响应

检查清单：
- [ ] 确认ANTHROPIC_API_KEY环境变量已正确设置
- [ ] 验证图片文件路径是否正确，文件是否存在
- [ ] 检查图片格式是否为支持的类型（PNG/JPG/WEBP/GIF）
- [ ] 确认图片文件大小不超过10MB
- [ ] 查看终端输出的详细错误信息

### 2. JSON结构不完整

诊断步骤：
- 检查AI返回的原始文本（在代码中添加print调试）
- 验证所有必需字段是否存在（metadata, visual, artistic, technical, semantic）
- 手动补全缺失的字段或使用默认值

### 3. 批量处理中断

恢复方法：
- 查看_summary.json识别已处理和未处理的文件
- 将失败的文件移到单独文件夹重新处理
- 检查是否因网络问题导致API调用失败

### 4. 性能优化

提升处理速度：
- 压缩大尺寸图片到合理分辨率（建议2048px以内）
- 使用SSD存储提高IO速度
- 考虑并发处理（需修改脚本支持异步调用）

### 5. 输出日志

所有脚本支持详细日志输出，运行时添加参数：
--verbose 查看详细处理过程
--debug 输出调试信息和API原始响应

---

## 元数据

| 字段 | 值 |
|------|----|
| 版本 | 1.0.0 |
| 作者 | Anonymous |
| 分类 | visual-creator, analyzer, content-creator |
| 技能类型 | analyzer, tool |
| 依赖项 | 运行时: python>=3.9; 包: pillow, anthropic |

## 更新日志

- **v1.0.0** (2026-01-22): added - 初始版本发布，支持基础图片分析、JSON双语输出、批量处理功能

